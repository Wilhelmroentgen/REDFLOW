name: recon-full

nodes:
  # 1) WHOIS / ASN
  - id: whois
    impl: whois

  - id: amass_asn
    impl: amass_intel
    params:
      max_orgs: 6

  # 2) Subdomains
  - id: subfinder
    impl: subfinder
    params:
      all: true
      silent: true

  - id: assetfinder
    impl: assetfinder

  - id: merge_subs
    impl: merge_sort_unique

  # 3) DNS resolution & surface
  - id: dnsx
    impl: dnsx
    params:
      resolver: "1.1.1.1"

  - id: dig_suite
    impl: dig_suite

  # 4) HTTP & ports
  - id: httpx
    impl: httpx
    params:
      jsonl: true
      include_title: true
      tech_detect: true

  - id: naabu
    impl: naabu
    params:
      top_ports: 100
      jsonl: true

  - id: nmap
    impl: nmap
    params:
      top_ports: 100
      stealth: true           # use -sS if permitted; set false to use -sT
      service_fp: true        # -sV
      treat_down_as_up: true  # -Pn

  # 5) Web fingerprinting & WAF + screenshots
  - id: web_fp
    impl: whatweb_waf_gowitness
    params:
      gowitness_threads: 3

  # 6) Historical URLs / crawling + params
  - id: urls_params
    impl: urls_params
    params:
      katana_depth: 2
      dedupe: true

  # 7) Directory fuzzing (prioritized)
  - id: ffuf
    impl: ffuf
    params:
      wordlist: "/usr/share/wordlists/seclists/Discovery/Web-Content/raft-medium-directories.txt"
      threads: 20
      match_codes: "200,204,301,302,401,403"
      filter_size: 0
      per_host_minutes: 10
      max_hosts: 30

  # 8) TLS / certificates
  - id: tls_meta
    impl: tlsx

  # 9) IdP / SSO footprint
  - id: idp_probe
    impl: idp_probe

  # 10) Graphs + report
  - id: render_graphs
    impl: render_graphs
    params:
      top_ports: 12
      top_tech: 20

  - id: report
    impl: report

edges:
  - [whois, amass_asn]
  - [amass_asn, subfinder]
  - [subfinder, assetfinder]
  - [assetfinder, merge_subs]
  - [merge_subs, dnsx]
  - [dnsx, dig_suite]
  - [dig_suite, httpx]
  - [httpx, naabu]
  - [naabu, nmap]
  - [nmap, web_fp]
  - [web_fp, urls_params]
  - [urls_params, ffuf]
  - [ffuf, tls_meta]
  - [tls_meta, idp_probe]
  - [idp_probe, render_graphs]
  - [render_graphs, report]
